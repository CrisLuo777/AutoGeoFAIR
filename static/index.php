<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="keywords" content="FAIR principles, assessment, evaluation, FAIR, research data, quality control, data maturity, metrics, digital objects">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">  
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
    <!-- <style>
        .loader {
            border: 16px solid #f3f3f3; /* Light grey */
            border-top: 16px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: spin 2s linear infinite;
            display: none;
            margin:auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style> -->


    <!-- ----------------------------- -->


    <!-- <script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script> -->
    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.css" rel='stylesheet' type='text/css' />
    <!-- Custom CSS -->
    <link href="css/style.css" rel='stylesheet' type='text/css' />
    <!-- font CSS -->
    <!-- font-awesome 矢量图标icons -->
    <link href="css/font-awesome.css" rel="stylesheet"> 
    <!-- //font-awesome icons -->
    <!-- js-->
    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="js/modernizr.custom.js"></script>
    <!--webfonts字体-->
    <link href='//fonts.googleapis.com/css?family=Roboto+Condensed:400,300,300italic,400italic,700,700italic' rel='stylesheet' type='text/css'>
    <!--//webfonts-->
    <!-- chart -->
    <script src="js/Chart.js"></script>
    <!-- //chart --> 
    <!--animate网页滚动时触发各种动画效果-->
    <link href="css/animate.css" rel="stylesheet" type="text/css" media="all">
    <script src="js/wow.min.js"></script>
        <script>
            new WOW().init();
        </script>
    <!--//end-animate-->
    <!-- Metis Menu 创建响应式的导航菜单-->
    <script src="js/metisMenu.min.js"></script>
    <script src="js/custom.js"></script>
    <link href="css/custom.css" rel="stylesheet">




   <!-- ---------------------------------- -->
    <link rel="icon" type="image/png" href="/icon/logo1.png">
    <title>FAIR程度评价简单客户端</title>
</head>
<body class="cbp-spmenu-push" style="padding-bottom: 70px;">
 <!-- ---------------------------------- -->
    <!-- <div class="main-content">   -->
    <div class=" sidebar" role="navigation">
                <div class="navbar-collapse">
                    <nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left" id="cbp-spmenu-s1">
                        <ul class="nav" id="side-menu">
                            
                            
                            <li>
                                <a href="index.php"><i class="fa fa-home nav_icon"></i>评价首页&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</a>
                            </li>
                            
                            

                            <li>
                                <a href="zhibiaoshezhi.html"><i class="fa fa-cogs nav_icon"></i>指标设置  &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp </a>
                               
                            
                                <!-- /nav-second-level -->
                            </li>
                            <li>
                                <a href="pingjiatongji.html" class="chart-nav"><i class="fa fa-bar-chart nav_icon"></i>评价统计 </a>
                            </li>
                                 
                            <li>
                                <a href="waiting.html"><i class="fa fa-file-text-o nav_icon"></i>关联网络评价</a>
                                
                            </li>
                            
                        </ul>
                        <div class="clearfix"> </div>
                        <!-- //sidebar-collapse -->
                    </nav>
        </div>
</div>


    <div class="sticky-header header-section ">
                <div class="header-left">
                    <!--toggle button start-->
                    <button id="showLeftPush"><i class="fa fa-bars"></i></button>
                    <!--toggle button end-->
                    <!--logo -->
                    <div class="logo">
                        <a href="index.php">
                            <h1>评价工具</h1>
                            <span>地表目录挖掘项目</span>
                        </a>
                    </div>
                    <!--//logo-->
                    <!--search-box-->
                    <div class="search-box">
                        <form class="input">
                            <input class="sb-search-input input__field--madoka" placeholder="搜索..." type="search" id="input-31" />
                            <label class="input__label" for="input-31">
                                <svg class="graphic" width="100%" height="100%" viewBox="0 0 404 77" preserveAspectRatio="none">
                                    <path d="m0,0l404,0l0,77l-404,0l0,-77z"/>
                                </svg>
                            </label>
                        </form>
                    </div><!--//end-search-box-->
                    <div class="clearfix"> </div>
                </div>
                <div class="header-right">
                    <div class="profile_details_left"><!--notifications of menu start -->
                        <ul class="nofitications-dropdown">
                            <li class="dropdown head-dpdn">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-envelope"></i><span class="badge">3</span></a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <div class="notification_header">
                                            <h3>You have 3 new messages</h3>
                                        </div>
                                    </li>
                                    <li><a href="#">
                                       <div class="user_img"><img src="images/1.png" alt=""></div>
                                       <div class="notification_desc">
                                        <p>Lorem ipsum dolor amet</p>
                                        <p><span>1 hour ago</span></p>
                                        </div>
                                       <div class="clearfix"></div>	
                                    </a></li>
                                    <li class="odd"><a href="#">
                                        <div class="user_img"><img src="images/2.png" alt=""></div>
                                       <div class="notification_desc">
                                        <p>Lorem ipsum dolor amet </p>
                                        <p><span>1 hour ago</span></p>
                                        </div>
                                      <div class="clearfix"></div>	
                                    </a></li>
                                    <li><a href="#">
                                       <div class="user_img"><img src="images/3.png" alt=""></div>
                                       <div class="notification_desc">
                                        <p>Lorem ipsum dolor amet </p>
                                        <p><span>1 hour ago</span></p>
                                        </div>
                                       <div class="clearfix"></div>	
                                    </a></li>
                                    <li>
                                        <div class="notification_bottom">
                                            <a href="#">See all messages</a>
                                        </div> 
                                    </li>
                                </ul>
                            </li>
                            <li class="dropdown head-dpdn">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-bell"></i><span class="badge blue">3</span></a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <div class="notification_header">
                                            <h3>You have 3 new notification</h3>
                                        </div>
                                    </li>
                                    <li><a href="#">
                                        <div class="user_img"><img src="images/2.png" alt=""></div>
                                       <div class="notification_desc">
                                        <p>Lorem ipsum dolor amet</p>
                                        <p><span>1 hour ago</span></p>
                                        </div>
                                      <div class="clearfix"></div>	
                                     </a></li>
                                     <li class="odd"><a href="#">
                                        <div class="user_img"><img src="images/1.png" alt=""></div>
                                       <div class="notification_desc">
                                        <p>Lorem ipsum dolor amet </p>
                                        <p><span>1 hour ago</span></p>
                                        </div>
                                       <div class="clearfix"></div>	
                                     </a></li>
                                     <li><a href="#">
                                        <div class="user_img"><img src="images/3.png" alt=""></div>
                                       <div class="notification_desc">
                                        <p>Lorem ipsum dolor amet </p>
                                        <p><span>1 hour ago</span></p>
                                        </div>
                                       <div class="clearfix"></div>	
                                     </a></li>
                                     <li>
                                        <div class="notification_bottom">
                                            <a href="#">See all notifications</a>
                                        </div> 
                                    </li>
                                </ul>
                            </li>	
                            <li class="dropdown head-dpdn">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-tasks"></i><span class="badge blue1">15</span></a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <div class="notification_header">
                                            <h3>You have 8 pending task</h3>
                                        </div>
                                    </li>
                                    <li><a href="#">
                                        <div class="task-info">
                                            <span class="task-desc">Database update</span><span class="percentage">40%</span>
                                            <div class="clearfix"></div>	
                                        </div>
                                        <div class="progress progress-striped active">
                                            <div class="bar yellow" style="width:40%;"></div>
                                        </div>
                                    </a></li>
                                    <li><a href="#">
                                        <div class="task-info">
                                            <span class="task-desc">Dashboard done</span><span class="percentage">90%</span>
                                           <div class="clearfix"></div>	
                                        </div>
                                        <div class="progress progress-striped active">
                                             <div class="bar green" style="width:90%;"></div>
                                        </div>
                                    </a></li>
                                    <li><a href="#">
                                        <div class="task-info">
                                            <span class="task-desc">Mobile App</span><span class="percentage">33%</span>
                                            <div class="clearfix"></div>	
                                        </div>
                                       <div class="progress progress-striped active">
                                             <div class="bar red" style="width: 33%;"></div>
                                        </div>
                                    </a></li>
                                    <li><a href="#">
                                        <div class="task-info">
                                            <span class="task-desc">Issues fixed</span><span class="percentage">80%</span>
                                           <div class="clearfix"></div>	
                                        </div>
                                        <div class="progress progress-striped active">
                                             <div class="bar  blue" style="width: 80%;"></div>
                                        </div>
                                    </a></li>
                                    <li>
                                        <div class="notification_bottom">
                                            <a href="#">See all pending tasks</a>
                                        </div> 
                                    </li>
                                </ul>
                            </li>	
                        </ul>
                        <div class="clearfix"> </div>
                    </div>
                    <!--notification menu end -->
                    <div class="profile_details">		
                        <ul>
                            <li class="dropdown profile_details_drop">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                    <div class="profile_img">	
                                        <span class="prfil-img"><img src="images/haomengqi.png" class="imageicon" alt=""> </span> 
                                        <div class="user-name">
                                            <p>郝孟璂</p>
                                            <span>Administrator</span>
                                        </div>
                                        <i class="fa fa-angle-down lnr"></i>
                                        <i class="fa fa-angle-up lnr"></i>
                                        <div class="clearfix"></div>	
                                    </div>	
                                </a>
                                <ul class="dropdown-menu drp-mnu">
                                    <li> <a href="#"><i class="fa fa-cog"></i> Settings</a> </li> 
                                    <li> <a href="#"><i class="fa fa-user"></i> Profile</a> </li> 
                                    <li> <a href="#"><i class="fa fa-sign-out"></i> Logout</a> </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div class="clearfix"> </div>	
                </div>
                <div class="clearfix"> </div>	
    </div>
 <!-- ---------------------------------- -->
    <!-- <nav class="navbar navbar-expand-lg navbar-light bg-light lead mb-4">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarfuji" aria-controls="navbarfuji" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="#">
                <img src="/icon/logo1.png" alt="" width="30" height="30" class="d-inline-block align-text-top"> <b>FAIR程度评价简单客户端</b>
            </a>
        </div>
    </nav> -->
<?php
// if(!isset($_SESSION))
//     session_start();
// set_time_limit(0);
######################## local config ##########################
$fuji_server = 'http://localhost:1071/fuji/api/v1/evaluate';
$fuji_username = 'liweijie';
$fuji_password = '991104';
################################################################

$fair_basic_terms=['F'=>'可发现性','A'=>'可获得性','I'=>'可互操作性','R'=>'可重用性'];
$fair_index=['F'=>0,'A'=>1,'I'=>2,'R'=>3];
$maturity_scale = [0=>'不合格',1=>'及格',2=>'优秀', 3=>'非常优秀'];
$status_scale = ['pass'=>'检测通过', 'fail'=>'未检测到'];
$maturity_palette = array(0=>'#fe7d37',1=>'#dfb317',2=>'#97ca00',3=>'#4c1');
$maturity_level_text_array = array(0=>'incomplete',1=>'initial',2=>'managed',3=>'defined');

$input_service_type = 'oai_pmh';
$input_service_url ='';
if (isset($_POST['service_url'])){
    $input_service_url = $_POST['service_url'];
    if (isset($_POST['service_type'])){
        $input_service_type = $_POST['service_type'];
    }
}

if(!isset($_POST['use_datacite'])){
    $usedatacite=false;
}else{
    $usedatacite=true;
}
if (isset($_REQUEST['pid'])){
    $input_pid = $_REQUEST['pid'];
}else {
    $input_pid =Null;
}
if (isset($_POST['service_url'])){
    $input_service_url = $_POST['service_url'];
    if (isset($_POST['service_type'])){
        $input_service_type = $_POST['service_type'];
    }
}
$allowed_service_types = array('ogc_csw'=>'OGC CSW标准','oai_pmh'=>'OAI-PMH标准', 'sparql'=>'SPARQL标准',''=>'无');

?>
    <div class="container">
        <h1 class="my-4 display-4 pl-2">FAIR程度评价</h1>
        <h1 class="my-4 display-4 pl-2">FAIR程度评价</h1>

        <!-- <div class="col-md-6 charts chrt-page-grids chrt-right">
						<h4 class="title">polar Area Chart</h4>
						<div class="polar-area">
							<canvas id="polarArea" height="300" width="400" style="width: 400px; height: 300px;"></canvas>
						</div>
					</div>
                    <script>
                    new Chart(document.getElementById("polarArea").getContext("2d")).PolarArea(chartData);
                    </script>	 -->
                    
        <div class="row my-auto">
            <div class="col">
                <?php
                if(!isset($input_pid)){
                    echo('<div class="lead" >
                        <h3 class="text-center">该工具是对数据资源通过FAIR原则可寻找性、可访问性、互操作性和可重复性作为指标的开放程度的评估</h3>
                        <h3 class="text-center">请先选择您的指标和算法，再输入您要评估的数据集的标识符（例如 DOI、URL）开始评估</h3>
                        </div>');
                }
                ?>
                <div class="card bg-light mx-auto" id="assessment_form">
                    <div class="card-body">
                        <form class="form mb-3" action="index.php" method="POST">  
                            <div class="row align-items-end">
                                <div class="col">
                                    <label for="pid" class="col-form-label-sm">数据的标识符 (URL/PID):</label>
                                    <input class="form-control form-control-sm" type="text" value="<?php echo $input_pid !== null ? htmlentities($input_pid) : ''; ?>" name="pid" id="pid" placeholder="输入一个有效的PID/UID（包括DOI或者其他网页）">
                                    <!-- <input  class="form-control form-control-sm" type="text" value="<?php echo(htmlentities($input_pid));?>" name="pid" id="pid" placeholder="Enter a valid PID or URL of the dataset's landing page (e.g. a DOI)"> -->
                                    <br>
                                    <label class="col-form-label-sm">选择指标集：</label>
                                    <select class="form-select form-select-sm" name="q">
                                            <option value="">选择指标集:</option>
                                            <option value="指标1">指标集1</option>
                                            <option value="指标2">指标集2</option>
                                            <option value="指标3">指标集3</option>
                                            </select>

                                    
                                    
                    
                                            
                                        
                                 
                                </div>
                               

                            </div>
                            <!-- <div class="row">
                                <div class="col ms-auto text-end">
                                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#assessment_settings" role="button" aria-expanded="false" aria-controls="collapseExample">
                                        <i class="bi-gear-fill"></i> 暂无
                                    </a>
                                </div>
                            </div> -->
                            <div  id="assessment_settings">

                                <div class="row align-items-end">
                                    <div class="col-8">
                                        <!-- <label for="service_url" class="col-form-label-sm">(可选) 元数据服务端点:</label>
                                        <input  class="form-control form-control-sm" type="text" value="<?php echo(htmlentities($input_service_url));?>" name="service_url" id="service_url" placeholder="(可选) 以不同格式提供元数据的端点"> -->
                                        <label class="col-form-label-sm">选择算法:</label>
                                        <select class="form-select form-select-sm" name="suanfa">
                                        <option value="">选择算法:</option>
                                        <option value="指标1">算法1</option>
                                        <option value="指标2">算法2</option>
                                        <option value="指标3">算法3</option>
                                        </select>


                                    </div>
                                    <div class="col-4">
                                        <label for="service_type" class="col-form-label-sm">元数据服务的类型:</label>
                                        <select class="form-select form-select-sm" name="service_type" id="service_type">
                                            <?php
                                            foreach($allowed_service_types as $sk=> $sv){
                                                if ($sk == $input_service_type)
                                                    echo '<option value ="'.$sk.'" selected>'.$sv.'</option>';
                                                else
                                                    echo '<option value ="'.$sk.'">'.$sv.'</option>';
                                            }
                                            ?>
                                        </select>
                                    </div>
                                    <div class="row align-items-end">
                                        <div class="col">
                                            <?php
                                            $usedatacite_checked = ' checked';
                                            if ($usedatacite == false)
                                                $usedatacite_checked = '';
                                            ?>
                                            <!-- <input type="checkbox" class="form-check-input" id="use_datacite" name="use_datacite" <?php echo($usedatacite_checked);?>>
                                            <label for="use_datacite" class="form-check-label "> 
                                                <small>Use DataCite?</small>
                                            </label> -->
                                            <!-- &nbsp;<img src="../icon/bootstrap/question-circle.svg" alt="帮助" width="15" height="15" data-toggle="tooltip" title="默认情况下，工具使用基于 DOI URL 的内容协商来检索 DataCite JSON 元数据。如果您取消选中此选项，F-UJI 将尝试改用着陆页网址。"> -->

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center">
                                <button type="input" class="my-custom-button" name="runtest"> 点击开始评估</button>
                            </div>
                            <input type="hidden" name="action" value="test">
                        </form>
                    </div>
                </div>
                    <div class="alert d-none mt-1" role ="alert" id="test_message"></div>

            </div>
        </div>
<?php

if (isset($input_pid)) {
    $ch = curl_init();
    $message = new stdClass();  #创建一个新的对象
    $message->object_identifier = $input_pid;
    $message->metadata_service_endpoint = $input_service_url;
    $message->metadata_service_type = $input_service_type;
    $message->test_debug = true;
    $message->use_datacite = $usedatacite;
    $post = json_encode($message);

    $username = $fuji_username;
    $password = $fuji_password;
    curl_setopt($ch, CURLOPT_URL, $fuji_server);
    curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type:application/json', 'Allow-Remote-Logging:True'));
    curl_setopt($ch, CURLOPT_USERPWD, $username . ":" . $password);
    curl_setopt($ch, CURLOPT_POST, 1);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $post);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    $server_output = curl_exec($ch);   # curl_exec执行cURL会话并返回服务器的响应结果。在这个例子中，
    $response = json_decode($server_output, true);
    curl_close($ch);
    if(!isset($response)){
        print('<div class="alert alert-danger" role="alert">服务器无响应 </div>');
    }
}

    $debug_class_list=array('SUCCESS'=>'table-success','WARNING'=>'table-warning','ERROR'=>'table-danger');
    $fuji_percent_scores=array(0=>0,1=>0,2=>0,3=>0);
    $sections=array();

    if(isset($response['results'])){
        $metric_version = str_replace('.yaml','',$response['metric_version']);
        $software_version = $response['software_version'];
        $metric_doi = $response['metric_specification'];
        if(is_array($response['results'])){
            $total_score = 0;
            $earned_score =0;
            $percent_score =0;
            $pid_url = Null;
            $summary = $response['summary'];    #总分数

            foreach ($response['results'] as $result) {
                $fair_letter=$result['metric_identifier'][4];
                if($result['metric_identifier']=='FsF-F2-01M'){
                    $metadata= $result['output']['core_metadata_found'];   #主要的元数据
                }
                if($result['metric_identifier']=='FsF-F1-02D'){
                    $pid_url= $result['output']['pid'];     #找到的PID
                }
                $fair_section_regex = '/\-([FAIR][0-9](\.[0-9])?)\-/m';
                $fair_section='';
                if(preg_match($fair_section_regex,$result['metric_identifier'],$fair_section_match))
                    $fair_section =$fair_section_match[1];    #匹配的字符
                $fuji_results[$fair_letter][$result['metric_identifier']] = $result;
            }
            ?>
            
            <h2 class="h2 mt-4 mb-3">评价结果:</h2>
            <h3 class="h3 mb-3">数据集标题:</h3>
            <div class="card mb-3">
                <h5 class="card-header"><?php
                    if(isset($metadata['title'])){
                        if(is_array($metadata['title']))
                            echo $metadata['title'][0];
                        else
                            echo(htmlentities($metadata['title']));
                    } else {
                        echo('&nbsp;');}?></h5>
                <div class="card-body p-2">

                    <table class="table mt-3 mb-3">
                        <tr>
                            <th>开放程度:
                                <!-- &nbsp;<img src="../icon/bootstrap/question-circle.svg" alt="help" width="15" height="15" data-toggle="tooltip" title="0:incomplete, 1:initial , 2:moderate, 3:advanced"> -->
                            </th>
                            <?php
                            $fair_maturity_color = $maturity_palette[round($summary['maturity']['FAIR'],0)];?>
                            <td><h4 class="h4 m-0"><span class="badge badge" style="color:white;background-color: <?php echo $fair_maturity_color;?>"><?php print($maturity_scale[round($summary['maturity']['FAIR'],0)]); ?></span></h4></td> 
                        <tr>  
                            <th>评价目标的PID/URL:</th>
                            <?php
                            if(strpos($input_pid,'http') !==false){  #查找字符函数php
                                ?>
                                <td class="text-break"><a <?php echo('href="'.$input_pid);?>"><?php echo(htmlentities($input_pid));?></a></td>  
                                <?php
                            } else{
                            ?>
                                <td class="text-break"><?php echo(htmlentities($input_pid));?></td>
                                <?php }
                            ?>
                        </tr>
                        <tr>
                            <th>指标集:</th>
                            <td>指标集1</td>
                        </tr>  
                    </table>
                </div>
            </div>
            <h3>总结:</h3>
            <div class="card-group">
                <div class="card mb-3">
                    <div class="my-auto mx-auto p-3" style="max-width: 250px">
                        <span class="display-2 text-nowrap"><?php print($summary['score_percent']['FAIR']) ?>分</span> 
                    </div>
                    <!-- 总分 -->
                </div>
                <div class="card mb-3">
                    <table class="table table-bordered table-responsive">
                        <tr><th></th><th class="d-sm-none d-md-block">指标通过:</th><th>FAIR等级:</th></tr>
                    <?php
                    foreach(array('F','A','I','R') as $fairid){
                        ?>
                        <tr>
                            <th><?php echo($fair_basic_terms[$fairid].': ');?></th>
                            <td style="min-width: 110px"  class="d-sm-none d-md-block"><?php
                                    print($summary['score_earned'][$fairid]);
                                    print(' / ');
                                    print($summary['score_total'][$fairid]);
                                    ?>
                            </td>
                            <td>
                                <?php
                                if(isset($summary['maturity'])){
                                    $principle_maturity_color = $maturity_palette[$summary['maturity'][$fairid]];
                                ?>
                                <h4 class="h4 m-0"><span class="badge badge" style="color:white;background-color: <?php echo $principle_maturity_color;?>"><?php print($maturity_scale[$summary['maturity'][$fairid]]); ?></span></h4></td>

                                <?php
                                }
                                ?>
                            </td>
                        </tr>
                        <?php
                    }
                    ?>
                    </table>
                </div>
            </div>
            <?php
            print('<h3>报告:</h3>');     #重要
            foreach($fuji_results as $fair_index=>$fuji_fairsection){
                print('<div class="xiaokapian">'.$fair_basic_terms[$fair_index].'</div>');  #映射过来F->可发现性
                print('<div class="accordion" id="accordion_'.$fair_index.'">');   #手风琴表单
                $test_index=0;
                foreach($fuji_fairsection as $fuji_res){
                    $test_index++;
                    print('<div class="class="accordion-item mb-3">');
                    print('<h2 class="accordion-header lead border border-1 mt-1" id="head_'.$fuji_res['metric_identifier'].'">');
                    print('<button class="accordion-button collapsed" data-bs-toggle="collapse"
                    data-bs-target="#body_'.$fair_index.'_'.$test_index.'" aria-expanded="false"
                    aria-controls="body_'.$fair_index.'_'.$test_index.'">');
                    print('<h5 class="h-5 " style="width:90%">');
                    $outputid = str_ireplace("FSF", "CUG", $fuji_res['metric_identifier']);
                    print(' 指标- '.$test_index.' - '.$fuji_res['metric_name']);
                    // print(' 指标- '.$outputid.' - '.$fuji_res['metric_name']);
                    print('</h5>');   #指标 标题

                    if($fuji_res['maturity'] >= 1)     #打勾
                        print('<img style="margin-left:auto; width:30px; float:right" src="/icon/passed.png">');
                    elseif(!is_int($fuji_res['maturity'])){
                        if($fuji_res['test_status']=='pass')
                            print('<img style="margin-left:auto; width:30px; float:right" src="/icon/passed.png">');
                        else
                            print('<img style="margin-left:auto; width:30px; float:right" src="/icon/unknown.png">');
                    }
                    else
                        print('<img style="margin-left:auto; width:30px; float:right" src="/icon/unknown.png">');
                    print('</button></h2>');
                    print('<div class="accordion-collapse collapse" aria-labelledby="head_'.$fair_index.'_'.$test_index.'" id="body_'.$fair_index.'_'.$test_index.'" data-parent="#accordion_'.$fair_index.'">');
                    print('<div class="accordion-body border rounded-1 border-1">');    #边框、圆角

                    if (!is_int($fuji_res['maturity'])){
                        $maturity_key = array_search($fuji_res['maturity'],$maturity_scale_old); #搜索数组maturity，[0=>'不合格',1=>'及格',2=>'优秀', 3=>'非常优秀']
                        if($maturity_key!==False) {
                            $fuji_res['maturity'] = $maturity_key;
                            $scaled_maturity = $maturity_scale[$maturity_key];
                            $maturity_color = $maturity_palette[$maturity_key];  #调色板
                        }else {
                            $scaled_maturity = $fuji_res['maturity'];
                            $maturity_color = 'grey';
                        }
                    }else{
                        $scaled_maturity = $maturity_scale[$fuji_res['maturity']];
                        $maturity_color = $maturity_palette[$fuji_res['maturity']];
                    }
                    print('<div class="row mb-2">      
                            <div class="col-md-2"><b>FAIR 等级:</b></div>
                            <div class="col-md-8">'.$fuji_res['maturity'].' / 3 </div>');   #FAIR分数  占据八列，总共12列
                    print('<div class ="col-md-2 text-right">
                            <span class="badge badge" style="color:white;background-color: '.$maturity_color.'">'.$scaled_maturity.'</span>  
                            </div>');             #非常优秀、绿色 右边“badge”徽章
                    print('</div>');
                    print('<div class="row mb-2"><div class="col-md-2"><b>分数:</b></div><div class="col-md-10">');
                    print($fuji_res['score']['earned'].' / '.$fuji_res['score']['total']);
                    print('</div></div>');
                    print('<div class="row mb-2"><div class="col-md-2"><b>输出:</b></div><div class="col-md-10">');
                    print('<pre><code>'.htmlspecialchars(json_encode($fuji_res['output'], JSON_PRETTY_PRINT)).'</code></pre>');  #<pre><code> 是 HTML 中的标签，用于在网页中显示预格式化的文本或代码块。它会保留文本中的空格、换行符和其他格式，并以等宽字体显示。
                    print('</div></div>');  #作用是在 HTML 中输出两个闭合的 div 标签。通过将这段代码放在适当的位置，可以正确地关闭之前打开的 div 元素，以保持 HTML 结构的正确性。
                    print('<div class="row mb-3"><div class="col-md-2"><b>测试指标:</b></div><div class="col-md-10">'); #mb-3是margin-bottom,下外边距为3
                    print('<table class="table w-100"><tr><th>测试一级指标:</th><th>指标名称:</th><th>分数:</th><th>Maturity:</th></th><th>结果:</th></tr>'); #w100宽度100%
                    foreach($fuji_res['metric_tests'] as $test_key=>$metric_test){     
                        if(preg_match('/-[0-9]{1}([a-z]{1})$/',$test_key,$tm)){      #tm用来存储字符匹配的结果
                            $mstyle=' style="font-size:smaller"';   #缩小显示
                            $test_key = '&nbsp;&nbsp;'.$tm[1];   #表示两个连续的不断行的空格
                        }else{
                            $mstyle='';
                        }
                        print('<tr'.$mstyle.'><th scope="row">'.$outputid.'</th><td>'.$metric_test['metric_test_name'].'</td><td>');
                        if($metric_test['metric_test_score'] !=0){
                            print($metric_test['metric_test_score']);
                        }
                        print('</td><td>');
                        if($metric_test['metric_test_status']=='pass'){
                            print($metric_test['metric_test_maturity']);
                        }
                        print('</td><td>');
                        if($metric_test['metric_test_status']=='pass')
                            print('<img class="mx-auto d-block" style="width:30px;" src="/icon/passed.png">');
                        else
                            print('<img class="mx-auto d-block" style="width:30px;" src="/icon/unknown.png">');
                        print('</td></tr>');
                    }
                    print('</table>');
                    print('</div></div>');
                    // print('<div class="row"><div class="col-md-2"><b>Debug messages:</b></div><div class="col-md-10">');
                    // print('<table class="table table-sm w-100 table-striped table-bordered"><tr><th>Level:</th><th>Message:</th></tr>');
                    // foreach($fuji_res['test_debug'] as $debug_message){
                    //     if(preg_match('/([A-Z]+):\s+(.*+)/',$debug_message,$debug_regex_result)) {
                    //         if(array_key_exists($debug_regex_result[1],$debug_class_list)){
                    //             $debug_class=' class="debug_'.$debug_regex_result[1].' '.$debug_class_list[$debug_regex_result[1]].'"';
                    //         }
                    //         else
                    //             $debug_class='';
                    //         print('<tr'.$debug_class.'><th scope="row">'.$debug_regex_result[1].'</th><td>'.$debug_regex_result[2].'</td></tr>');
                    //     }
                    // }
                    // print('</table>');
                    // print('</div></div>');
                    //显示的是DEBUG的信息
                    print('</div></div>');
                    print('</div>');
                }
                print('</div>');
            }
        }
    }elseif(isset($response['status'])){
        if ($response['status']==401) {
            print('<div id="fuji_error" class="alert alert-danger">');
            print('<b>授权失败</b>');
            print('</div>');
        }
        elseif ($response['status']==500) {
            print('<div id="fuji_error" class="alert alert-danger">');
            print('<b>'.$response['title'].'</b>');
            print('<br>');
            print($response['detail']);
            print('<br> 如果此错误仍然存在，请报告: <a href="https://github.com/pangaea-data-publisher/fuji/issues">
            https://github.com/pangaea-data-publisher/fuji/issues</a>');
            print('</div>');
        }else{
            print('<div id="fuji_error" class="alert alert-danger">');
            print('<b>错误码: </b>'.$response['status']);
            print('</div>');
        }
    }
    ?>
        <div class="navbar">
            
                <div class="justify-content-center">
                    《地球表层系统开放数据目录挖掘与关联网络》子课题
                </div>
            </div>
    </div>
</div>


<script src="js/classie.js"></script>
		<script>
			var menuLeft = document.getElementById( 'cbp-spmenu-s1' ),
				showLeftPush = document.getElementById( 'showLeftPush' ),
				body = document.body;
				
			showLeftPush.onclick = function() {
				classie.toggle( this, 'active' );
				classie.toggle( body, 'cbp-spmenu-push-toright' );
				classie.toggle( menuLeft, 'cbp-spmenu-open' );
				disableOther( 'showLeftPush' );
			};
			

			function disableOther( button ) {
				if( button !== 'showLeftPush' ) {
					classie.toggle( showLeftPush, 'disabled' );
				}
			}
		</script>
	<!--scrolling js-->
	<!-- <script src="js/jquery.nicescroll.js"></script> -->
	<script src="js/scripts.js"></script>
	<!--//scrolling js-->
	<!-- Bootstrap Core JavaScript -->
   <script src="js/bootstrap.js"> </script>
</body>
</html>
